<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Skupper - Getting started</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,200italic,300,300italic,400,400italic,600,700,900|Roboto+Mono:300,400,500,700|Alegreya+Sans:400,600,700,800,900" type="text/css"/>
    <link rel="stylesheet" href="https://skupperproject.github.io/skupper-website/main.css" type="text/css"/>
    <link rel="icon" href="" type="image/png"/>
    <script type="text/javascript" src="https://skupperproject.github.io/skupper-website/main.js" defer="defer"></script>



  </head>
  <body>

<header>
  <div>
    <nav id="-top-left-nav">
      <a href="https://skupperproject.github.io/skupper-website/index.html" id="-logotype"><img class="inline-icon" src="https://skupperproject.github.io/skupper-website/images/circle.svg"/> Skupper</a>
      <a href="https://skupperproject.github.io/skupper-website/start/index.html">Getting started</a>
      <a href="https://skupperproject.github.io/skupper-website/examples/index.html">Examples</a>
      <!-- <a href="https://skupperproject.github.io/skupper-website/docs/index.html">Documentation</a> -->
    </nav>
    <nav id="-top-right-nav">
      <a href="https://github.com/skupperproject"><img class="inline-icon" src="https://skupperproject.github.io/skupper-website/images/github.svg"/> GitHub</a>
    </nav>
  </div>
</header>

<section>
  <div>

<h1 id="getting-started-with-skupper">Getting started with Skupper</h1>

<nav class="toc">
  <a href="#prerequisites">Prerequisites</a>
  <a href="#step-1-install-the-skupper-command">Step 1: Install the Skupper command</a>
  <a href="#step-2-configure-access-to-multiple-namespaces">Step 2: Configure access to multiple namespaces</a>
  <a href="#step-3-establish-the-skupper-infrastructure-in-each-namespace">Step 3: Establish the Skupper infrastructure in each namespace</a>
  <a href="#step-4-connect-your-namespaces">Step 4: Connect your namespaces</a>
  <a href="#step-5-expose-your-services">Step 5: Expose your services</a>
  <a href="#the-condensed-version">The condensed version</a>
  <a href="#next-steps">Next steps</a>
</nav>

<h2 id="prerequisites">Prerequisites</h2>

<p>To get started with Skupper, you must have access to at least two
Kubernetes namespaces.  In the steps below, replace <code>&lt;ns1&gt;</code> and
<code>&lt;ns2&gt;</code> with your chosen namespaces.</p>

<p>Each namespace can reside on <strong>any cluster you choose</strong>, and <strong>you are
not limited to two</strong>.  You can have one on your laptop, another on
Amazon, another on Google, and so on.  For convenience, you can have
them all on one cluster.</p>

<p>Skupper works with any flavor of Kubernetes.  Here are some of your
options for setting up namespaces:</p>

<ul>
<li><a href="https://kubernetes.io/docs/setup/learning-environment/minikube/">Minikube</a></li>
<li><a href="https://aws.amazon.com/eks/getting-started/">Amazon EKS</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/quickstart">Google GKE</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/intro-kubernetes">Microsoft AKS</a></li>
<li><a href="https://www.openshift.com/learn/get-started/">Red Hat OpenShift</a></li>
</ul>

<h2 id="step-1-install-the-skupper-command">Step 1: Install the Skupper command</h2>

<p>The <code>skupper</code> command-line tool is the primary entrypoint for
installing and configuring the Skupper infrastructure.  You need to
install the <code>skupper</code> command only once for each development
environment.</p>

<h3 id="download-and-extract-the-command">Download and extract the command</h3>

<p>To get the latest release of the Skupper command for your platform,
download it from GitHub and extract the executable using <code>tar</code> or
<code>unzip</code>.</p>

<div class="code-block-label">Linux</div>

<pre><code>curl -fL https://github.com/skupperproject/skupper-cli/releases/download/0.0.1-alpha/linux.tgz | tar -xzf -
</code></pre>

<div class="code-block-label">macOS</div>

<pre><code>curl -fL https://github.com/skupperproject/skupper-cli/releases/download/0.0.1-alpha/darwin.zip -o skupper.zip
unzip skupper.zip
</code></pre>

<p>This produces an executable file named <code>skupper</code> in your current
directory.</p>

<h3 id="place-the-command-on-your-path">Place the command on your path</h3>

<p>The subsequent steps assume <code>skupper</code> is on your path.  As an
example, this is how you might install it in your home directory:</p>

<pre><code>mkdir -p ~/bin
export PATH=$PATH:~/bin
mv skupper ~/bin
</code></pre>

<h3 id="check-the-command">Check the command</h3>

<p>To test your installation, run the <code>skupper</code> command with no
arguments.  You should see a usage summary.</p>

<pre><code>$ skupper
Usage:
  skupper [command]

Available Commands:
[...]
</code></pre>

<h2 id="step-2-configure-access-to-multiple-namespaces">Step 2: Configure access to multiple namespaces</h2>

<p>Skupper is designed for use with multiple namespaces, typically on
different clusters.  The <code>skupper</code> command uses your kubeconfig and
current context to select the namespace where it operates.</p>

<p>To avoid getting your wires crossed, you must use a distinct
kubeconfig or context for each namespace.  The easiest way is to use
separate console sessions.</p>

<h3 id="configure-separate-console-sessions">Configure separate console sessions</h3>

<p>Start a console session for each of your namespaces.  Set the
<code>KUBECONFIG</code> environment variable to a different path in each session:</p>

<div class="code-block-label">Console session for namespace 1</div>

<pre><code>export KUBECONFIG=~/.kube/config-&lt;ns1&gt;
</code></pre>

<div class="code-block-label">Console session for namespace 2</div>

<pre><code>export KUBECONFIG=~/.kube/config-&lt;ns2&gt;
</code></pre>

<h3 id="log-in-and-set-your-namespaces">Log in and set your namespaces</h3>

<p>The methods for logging in and setting the current namespace are
specific to your Kubernetes provider.  See the following links for
more information:</p>

<ul>
<li><a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">Vanilla Kubernetes (including Minikube)</a></li>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html">Amazon EKS</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl">Google GKE</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough#connect-to-the-cluster">Microsoft AKS</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.1/cli_reference/getting-started-cli.html#cli-logging-in_cli-developer-commands">Red Hat OpenShift</a></li>
</ul>

<h3 id="check-your-configurations">Check your configurations</h3>

<p>Once you have logged in, use the <code>skupper status</code> command to check
that each namespace is correctly configured.  You should see the
following output:</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>$ skupper status
Skupper is not installed in '&lt;ns1&gt;'.  Use 'skupper init' to install.
</code></pre>

<div class="code-block-label">Namespace 2</div>

<pre><code>$ skupper status
Skupper is not installed in '&lt;ns2&gt;'.  Use 'skupper init' to install.
</code></pre>

<h2 id="step-3-establish-the-skupper-infrastructure-in-each-namespace">Step 3: Establish the Skupper infrastructure in each namespace</h2>

<p>The <code>skupper init</code> command installs the Skupper router, proxy, and
related resources in the current namespace.</p>

<pre><code>skupper init [--id &lt;installation-name&gt;]
</code></pre>

<h3 id="install-the-infrastructure">Install the infrastructure</h3>

<p>Run <code>skupper init</code> once for each namespace you wish to connect.</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>skupper init
</code></pre>

<div class="code-block-label">Namespace 2</div>

<pre><code>skupper init
</code></pre>

<p>You should see output like this:</p>

<pre><code>Skupper is now installed in '&lt;ns&gt;'.  Use 'skupper status' to get more information.
</code></pre>

<h3 id="check-the-infrastructure">Check the infrastructure</h3>

<p>To check the status of each namespace, use the <code>skupper status</code>
command.</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>$ skupper status
Namespace '&lt;ns1&gt;' is ready.  It is connected to 0 other namespaces.
</code></pre>

<div class="code-block-label">Namespace 2</div>

<pre><code>$ skupper status
Namespace '&lt;ns2&gt;' is ready.  It is connected to 0 other namespaces.
</code></pre>

<h2 id="step-4-connect-your-namespaces">Step 4: Connect your namespaces</h2>

<p>After installation, you have the infrastructure you need, but your
namespaces are not connected.  Creating a connection requires use of
two <code>skupper</code> commands in conjunction:</p>

<pre><code>skupper connection-token &lt;output-token-file&gt;
skupper connect &lt;input-token-file&gt;
</code></pre>

<p>The <code>skupper connection-token</code> command generates a secret token that
signifies permission to connect.  The token also carries the
connection details.  Anyone who has it can use the <code>skupper connect</code>
command to establish a connection from another namespace.</p>

<h3 id="generate-a-connection-token">Generate a connection token</h3>

<p>Use the <code>skupper connection-token</code> command to generate a token.</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>skupper connection-token ~/secret.yaml
</code></pre>

<h3 id="use-the-token-to-form-a-connection">Use the token to form a connection</h3>

<p>With the token in hand, you are ready to connect.  Pass the token from
namespace 1 to the <code>skupper connect</code> command in namespace 2.</p>

<div class="code-block-label">Namespace 2</div>

<pre><code>skupper connect ~/secret.yaml
</code></pre>

<h3 id="check-the-connection">Check the connection</h3>

<p>Use the <code>skupper status</code> command again to see if things have changed.
If the connection is made, you should see the following output:</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>$ skupper status
Namespace '&lt;ns1&gt;' is ready.  It is connected to 1 other namespace.
</code></pre>

<div class="code-block-label">Namespace 2</div>

<pre><code>$ skupper status
Namespace '&lt;ns2&gt;' is ready.  It is connected to 1 other namespace.
</code></pre>

<h2 id="step-5-expose-your-services">Step 5: Expose your services</h2>

<p>You now have a network capable of multi-cluster communication, but no
services are attached to it.  This step uses the <code>kubectl annotate</code>
command to make a Kubernetes service on one namespace available on all
the connected namespaces.</p>

<pre><code>kubectl annotate &lt;service&gt; skupper.io/proxy=(http|tcp)
</code></pre>

<h3 id="deploy-your-application">Deploy your application</h3>

<p>To demonstrate service exposure, we need an application to work with.
This guide uses an HTTP Hello World application with a backend and a
frontend.  Use <code>kubectl run</code> and <code>kubectl expose</code> to start the backend
on namespace 1 and create a service for it.</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>kubectl run hello-world-backend --image quay.io/skupper/hello-world-backend --port 8080
kubectl expose deployment/hello-world-backend
</code></pre>

<p>Use <code>kubectl run</code> to start the frontend on namespace 2.  Use <code>kubectl
expose</code> with <code>--type LoadBalancer</code> to make the frontend externally
accessible.</p>

<div class="code-block-label">Namespace 2</div>

<pre><code>kubectl run hello-world-frontend --image quay.io/skupper/hello-world-frontend --port 8080
kubectl expose deployment/hello-world-frontend --type LoadBalancer
</code></pre>

<h3 id="expose-the-service">Expose the service</h3>

<p>Use the <code>kubectl annotate</code> command on namespace 1 to make
<code>hello-world-backend</code> available on namespace 2.</p>

<div class="code-block-label">Namespace 1</div>

<pre><code>kubectl annotate service/hello-world-backend skupper.io/proxy=http
</code></pre>

<h3 id="check-the-service">Check the service</h3>

<p>Use <code>kubectl get services</code> on namespace 2 to make sure the
<code>hello-world-backend</code> service from namespace 1 is represented.  You
should see output like this:</p>

<div class="code-block-label">Namespace 2</div>

<pre><code>$ kubectl get services
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP      PORT(S)          AGE
[...]
hello-world-backend    ClusterIP      10.106.92.175    &lt;none&gt;           8080/TCP         11h
hello-world-frontend   LoadBalancer   10.111.133.137   10.111.133.137   8080:31313/TCP   6m31s
[...]
</code></pre>

<p>Note: If you are using Minikube and the external IP shows <code>&lt;pending&gt;</code>,
you need to use the <code>minikube tunnel</code> command to provide ingress.</p>

<h3 id="test-your-application">Test your application</h3>

<p>Now your multi-cluster application is up and running.  Use <code>curl</code> to
see it in action.</p>

<div class="code-block-label">Namespace 2</div>

<pre><code>curl $(kubectl get service/hello-world-frontend -o jsonpath='http://{.status.loadBalancer.ingress[0].ip}:{.spec.ports[0].port}/')
</code></pre>

<p>You should see output like this:</p>

<pre><code>I am the frontend.  The backend says 'Hello 1'.
</code></pre>

<h2 id="the-condensed-version">The condensed version</h2>

<div class="code-block-label">Skupper command installation</div>

<pre><code>curl -fL https://github.com/skupperproject/skupper-cli/releases/download/0.0.1-alpha/linux.tgz | tar -xzf -
</code></pre>

<div class="code-block-label">Namespace 1</div>

<pre><code>export KUBECONFIG=~/.kube/config-&lt;ns1&gt;
&lt;provider-login-command&gt;
skupper init
skupper connection-token ~/secret.yaml
kubectl run hello-world-backend --image quay.io/skupper/hello-world-backend --port 8080
kubectl expose deployment/hello-world-backend
kubectl annotate deployment/hello-world-backend skupper.io/proxy=http
</code></pre>

<div class="code-block-label">Namespace 2</div>

<pre><code>export KUBECONFIG=~/.kube/config-&lt;ns2&gt;
&lt;provider-login-command&gt;
skupper init
skupper connect ~/secret.yaml
kubectl run hello-world-frontend --image quay.io/skupper/hello-world-frontend --port 8080
kubectl expose deployment/hello-world-frontend --type LoadBalancer
curl $(kubectl get service/hello-world-frontend -o jsonpath='http://{.status.loadBalancer.ingress[0].ip}:{.spec.ports[0].port}/')
</code></pre>

<h2 id="next-steps">Next steps</h2>

<p>Now that you know how to connect services running on multiple
clusters, here are a few more things to look at:</p>

<ul>
<li><a href="https://github.com/skupperproject/skupper-example-hello-world">Use and modify the HTTP Hello World example</a></li>
<li><a href="https://github.com/skupperproject/skupper-example-tcp-echo">See how you can connect any TCP-based service</a></li>
<li><a href="https://skupperproject.github.io/skupper-website/examples/index.html">Explore the examples</a></li>
</ul>


  </div>
</section>

<footer>
  <div>
  </div>
</footer>




  </body>
</html>
